---
title: "Karate Club Schism"
author: "Johannes Nakayama"
date: "1 4 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(igraph)
library(ggplot2)
library(tidyr)
library(forcats)
karate_outcomes <- readr::read_delim(file.path("data", "karate_outcomes.csv"), delim = ";")
```



```{r}
outcomes_full <- arrow::read_feather(file.path("data", "simulation_outcomes", "outcomes_full.arrow"))
```

```{r}

outcomes_full %>% 
  mutate(id = as.character(id),
         config = factor(config)) %>% 
  group_by(id) %>% 
  mutate(mean_tendency = mean(tendency),
         median_tendency = median(tendency)) %>% 
  ungroup() %>% 
  arrange(desc(mean_tendency)) %>% 
  ggplot(aes(x = fct_inorder(id), y = tendency, color = config)) +
  geom_hline(yintercept = 0, alpha = 0.5, linetype = "dashed") +
  geom_point(alpha = 0.3) +
  scale_color_viridis_d() +
  labs(x = "ID", y = "Outcome") +
  coord_flip() +
  theme_bw() +
  theme(legend.position = "None")

```




```{r}

random_cfg <- arrow::read_feather(file.path("data", "simulation_records", "random_config.arrow"))

```



```{r}

random_cfg %>% 
  filter(step == max(step)) %>% 
  select(replicate, culture) %>% 
  distinct() %>% 
  group_by(replicate) %>% 
  summarize(unique_cultures = n()) %>% 
  ungroup() %>% 
  group_by(unique_cultures) %>% 
  summarize(count = n()) %>% 
  ungroup()

```




# Benchmark 1: The Classical Model of Opinion Dynamics


```{r}

classical_model <- arrow::read_feather(file.path("data", "classical_model", "classical_model.arrow"))

```


```{r}

# example replicate
classical_model %>% 
  filter(replicate == 6) %>% 
  ggplot(aes(x = step, y = opinion, color = factor(id))) +
  geom_line() +
  ylim(c(-1, 1)) +
  theme_bw() +
  theme(legend.position = "None")

# consensus in all runs
classical_model %>% 
  filter(step == max(step)) %>% 
  select(-step) %>% 
  group_by(replicate) %>% 
  summarize(mean_opinion = mean(opinion),
            var_opinion = round(var(opinion), 3)) %>%
  ungroup() -> tmp 

max(tmp$var_opinion)

tmp %>% 
  ggplot(aes(x = replicate, y = mean_opinion)) +
  geom_point() +
  ylim(c(-1, 1)) +
  theme_bw()


```



# Benchmark 2: The Friedkin-Johnson Model

```{r}

friedkin_johnson <- arrow::read_feather(file.path("data", "friedkin_johnson", "friedkin_johnson.arrow"))
# rm(friedkin_johnson)
```


```{r}

friedkin_johnson %>% 
  filter(replicate == 100) %>% 
  filter(step <= 15) %>% 
  ggplot(aes(x = step, y = opinion, color = factor(id))) +
  geom_line(size = 0.6) +
  theme_bw() +
  theme(legend.position = "None")

```













































